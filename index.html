---
layout: default
---

<div class="row">
  <div class="col-3 left-column-1">
    <div class="left-column-2">
      <p id="title">Mind<br>the<br>gap</p>
      <p id="subheading">An interactive chart of the<br>occupations of US workers.</p>
      <p class="select-title">Select x-axis:</p>
      <select id="xaxis" onchange="changeAxis()">
        <option value="women">Women</option>
        <option value="men">Men</option>
        <option value="white">White</option>
        <option value="black">Black</option>
        <option value="asian">Asian</option>
        <option value="latino">Hispanic/Latino</option>
        <option value="total_weekly">Total Weekly</option>
        <option value="men_weekly">Men Weekly</option>
        <option value="women_weekly">Women Weekly</option>
        <option value="median_age">Median Age</option>
      </select>
      <p class="select-title">Select y-axis:</p>
      <select id="yaxis" onchange="changeAxis()">
        <option value="women">Women</option>
        <option value="men">Men</option>
        <option value="white">White</option>
        <option value="black">Black</option>
        <option value="asian">Asian</option>
        <option value="latino">Hispanic/Latino</option>
        <option value="total_weekly">Total Weekly</option>
        <option value="men_weekly">Men Weekly</option>
        <option value="women_weekly">Women Weekly</option>
        <option value="median_age">Median Age</option>
      </select>
    </div>
  </div>
  <div class="col-9 right-col">
    <canvas id="chart" width="600" height="400"></canvas>
  </div>
</div>

<script type="text/javascript" src="datasets.js"></script>

<script>

var ctx = document.getElementById('chart').getContext('2d');
var x_axis, y_axis;
var current_datasets = [];

function getXaxisValue() {
  x_axis = document.getElementById("xaxis").value;
  // console.log('get x axis called')
}

function getYaxisValue() {
  y_axis = document.getElementById("yaxis").value;
  // console.log('get y axis called')
}

function changeAxis() {
  console.log('change axis called')
  getXaxisValue();
  getYaxisValue();
  generateRealDatasets();
  updateChart(scatterChart);
}

function updateChart(chart) {
  // maybe not necessary?
  // console.log(chart.options);
  // $('#chart').remove();
  // $('.right-col').append('<canvas id="chart" width="600" height="400"><canvas>');
  // ctx = document.getElementById('chart').getContext('2d');
  // scatterChart = new Chart(ctx, chartOptions());
  //
  chart.options.scales.xAxes[0].scaleLabel.labelString = x_axis;
  chart.options.scales.yAxes[0].scaleLabel.labelString = y_axis;
  chart.datasets = current_datasets;
  chart.update();

  // console.log(chart.options.scales)
}

function createDataset(x_axis,y_axis,dataset) {
  temp_dataset = [];
  dataset.forEach(function(currentValue, i) {
    temp_dataset.push({
      x: currentValue[x_axis],
      y: currentValue[y_axis],
      r: currentValue.num_employed/200
    })
  });
  return temp_dataset;
}

function numberWithCommas(x) {
    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}

function generateRealDatasets() {
  // go through datasets.js and return a real dataset
  datasets.forEach(function(currentValue, i) {
    current_datasets.push({
      label: currentValue.label,
      fill: currentValue.fill,
      backgroundColor: currentValue.backgroundColor,
      data: createDataset(x_axis,y_axis,currentValue.data),
    })
  });
  // console.log('generate real datasets called')
}

function chartOptions() {
  return {
        type: 'bubble',
        data: {
            datasets: current_datasets
        },
        options: {
            title: {
              display: true,
            },
            legend: {
              display: false
            },
            tooltips: {
              displayColors: false,
                callbacks: {
                  title: function(tooltipItem, data) {
                    // tooltipitem {0: []}
                    // Return value for title
                    var item = datasets[tooltipItem[0].datasetIndex].data[tooltipItem[0].index]
                    return item.job || '';
                  },
                  label: function(tooltipItem, data) {
                    var item = datasets[tooltipItem.datasetIndex].data[tooltipItem.index]
                    var label = [];
                    label.push("Number employed: " + numberWithCommas(item.num_employed*1000));

                    label.push("Women: " + item.women + "%");
                    label.push("Men: " + item.men + "%");
                    label.push("White: " + item.white + "%");
                    label.push("Black: " + item.black + "%");
                    label.push("Asian: " + item.asian + "%");
                    label.push("Hispanic/Latino: " + item.latino + "%");
                    label.push(""); // new line
                    label.push("Average Salary: $" + numberWithCommas(item.total_weekly) + "/week");
                    label.push("Average Male Salary: $" + numberWithCommas(item.men_weekly) + "/week");
                    label.push("Average Female Salary: $" + numberWithCommas(item.women_weekly) + "/week");
                    label.push(""); // new line
                    label.push("Median Age: " + item.median_age + " years");
                    return label;
                  },
                }
            },
            scales: {
                xAxes: [{
                    type: 'linear',
                    scaleLabel: {
                      display: true,
                      labelString: x_axis
                    }
                    // position: 'bottom'
                }],
                yAxes: [{
                    type: 'linear',
                    scaleLabel: {
                      display: true,
                      labelString: y_axis
                    }
                    // position: 'bottom'
                }]
            },
            // Container for pan options
            pan: {
                // Boolean to enable panning
                enabled: true,
                mode: 'y'
            },

            // Container for zoom options
            zoom: {
                speed: 0.01,
                enabled: true,
                mode: 'xy',
                  limits: {
      							max: 10,
      							min: 0.5
      						}
            }
        }
    }
}

getXaxisValue();
getYaxisValue();
generateRealDatasets();

var scatterChart;

scatterChart = new Chart(ctx, chartOptions());
</script>
<!-- <body>
  <div style="width:75%;">
    <canvas id="canvas"></canvas>
  </div>
  <br>
  <br>
  <button id="replaceDataObject">REPLACE ENTIRE DATA OBJECT</button>
  <button id="randomizeData">Randomize Data</button>
  <button id="addDataset">Add Dataset</button>
  <button id="removeDataset">Remove Dataset</button>
  <button id="addData">Add Data</button>
  <button id="removeData">Remove Data</button>
  <script>
    window.chartColors = {
      red: 'rgb(255, 99, 132)',
      orange: 'rgb(255, 159, 64)',
      yellow: 'rgb(255, 205, 86)',
      green: 'rgb(75, 192, 192)',
      blue: 'rgb(54, 162, 235)',
      purple: 'rgb(153, 102, 255)',
      grey: 'rgb(231,233,237)'
    };

    window.randomScalingFactor = function() {
      return (Math.random() > 0.5 ? 1.0 : -1.0) * Math.round(Math.random() * 100);
    }

    var MONTHS = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
    var config = {
      type: 'line',
      data: {
        labels: ["January", "February", "March", "April", "May", "June", "July"],
        datasets: [{
          label: "My First dataset",
          backgroundColor: window.chartColors.red,
          borderColor: window.chartColors.red,
          data: [
            randomScalingFactor(),
            randomScalingFactor(),
            randomScalingFactor(),
            randomScalingFactor(),
            randomScalingFactor(),
            randomScalingFactor(),
            randomScalingFactor()
          ],
          fill: false,
        }, {
          label: "My Second dataset",
          fill: false,
          backgroundColor: window.chartColors.blue,
          borderColor: window.chartColors.blue,
          data: [
            randomScalingFactor(),
            randomScalingFactor(),
            randomScalingFactor(),
            randomScalingFactor(),
            randomScalingFactor(),
            randomScalingFactor(),
            randomScalingFactor()
          ],
        }]
      },
      options: {
        responsive: true,
        title: {
          display: true,
          text: 'Chart.js Line Chart'
        },
        tooltips: {
          mode: 'index',
          intersect: false,
        },
        hover: {
          mode: 'nearest',
          intersect: true
        },
        scales: {
          xAxes: [{
            display: true,
            scaleLabel: {
              display: true,
              labelString: 'Month'
            }
          }],
          yAxes: [{
            display: true,
            scaleLabel: {
              display: true,
              labelString: 'Value'
            }
          }]
        }
      }
    };

    document.getElementById('randomizeData').addEventListener('click', function() {
      config.data.datasets.forEach(function(dataset) {
        dataset.data = dataset.data.map(function() {
          return randomScalingFactor();
        });
      });
      window.myLine.update();
    });


    document.getElementById('replaceDataObject').addEventListener('click', function() {
      var newDataObject = {
        labels: ["January", "February", "March", "April", "May", "June", "July"],
        datasets: [{
          label: "My First dataset",
          fill: false,
          lineTension: 0.1,
          backgroundColor: "rgba(75,192,192,0.4)",
          borderColor: "rgba(75,192,192,1)",
          borderCapStyle: 'butt',
          borderDash: [],
          borderDashOffset: 0.0,
          borderJoinStyle: 'miter',
          pointBorderColor: "rgba(75,192,192,1)",
          pointBackgroundColor: "#fff",
          pointBorderWidth: 1,
          pointHoverRadius: 5,
          pointHoverBackgroundColor: "rgba(75,192,192,1)",
          pointHoverBorderColor: "rgba(220,220,220,1)",
          pointHoverBorderWidth: 2,
          pointRadius: 1,
          pointHitRadius: 10,
          data: [100, 200, 300, 81, 56, 55, 40],
          spanGaps: false,
        }]
      };
			console.log(myLine.data);
			// the newDataObject does not override myLine.data object: why???
      myLine.data = newDataObject;
			// ... but updating a single value works: why???
			myLine.data.datasets[0].data[0] = 5000;
			console.log(myLine.data);
      window.myLine.update();
    });




    var colorNames = Object.keys(window.chartColors);
    document.getElementById('addDataset').addEventListener('click', function() {
      var colorName = colorNames[config.data.datasets.length % colorNames.length];
      var newColor = window.chartColors[colorName];
      var newDataset = {
        label: 'Dataset ' + config.data.datasets.length,
        backgroundColor: newColor,
        borderColor: newColor,
        data: [],
        fill: false
      };
      for (var index = 0; index < config.data.labels.length; ++index) {
        newDataset.data.push(randomScalingFactor());
      }
      config.data.datasets.push(newDataset);
      window.myLine.update();
    });
    document.getElementById('addData').addEventListener('click', function() {
      if (config.data.datasets.length > 0) {
        var month = MONTHS[config.data.labels.length % MONTHS.length];
        config.data.labels.push(month);
        config.data.datasets.forEach(function(dataset) {
          dataset.data.push(randomScalingFactor());
        });
        window.myLine.update();
      }
    });
    document.getElementById('removeDataset').addEventListener('click', function() {
      config.data.datasets.splice(0, 1);
      window.myLine.update();
    });
    document.getElementById('removeData').addEventListener('click', function() {
      config.data.labels.splice(-1, 1); // remove the label first
      config.data.datasets.forEach(function(dataset, datasetIndex) {
        dataset.data.pop();
      });
      window.myLine.update();
    });

    window.onload = function() {
      var ctx = document.getElementById("canvas").getContext("2d");
      window.myLine = getNewChart(ctx, config);
    };

				function getNewChart(canvas, config) {
		        return new Chart(canvas, config);
				}



  </script>

</body> -->
