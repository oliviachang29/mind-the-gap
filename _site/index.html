<!DOCTYPE html>
<html lang="en">
	<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>
     
    
  </title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width">

  <link href="https://fonts.googleapis.com/css?family=Playfair+Display" rel="stylesheet">
  <link rel="stylesheet" href="/assets/css/main_css_file.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
  <script src="/assets/js/hammer.min.js"></script>
  <script src="https://npmcdn.com/Chart.Zoom.js@latest/Chart.Zoom.min.js"></script>

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
  <!-- keep this -->
  <script src="/assets/js/jquery.min.js"></script>
  <!--
  <script src="/assets/js/popper.min.js"></script>
  <script src="/assets/js/bootstrap.min.js"></script> -->

</head>

	<body>
		<div class="row">
  <div class="col-3 left-column-1">
    <div class="left-column-2">
      <p id="title" class="noselect">Mind<br>the<br>gap</p>
      <p id="subheading">An beautiful, interactive visualization of US occupations.</p>
      <hr>

      <p class="select-title category-title">X-Axis</p>
      <select id="xaxis" class="clickable" onchange="changeAxis()">
        <option value="men_weekly">Average weekly earnings for men</option>
        <option value="women_weekly" selected>Average weekly earnings for women</option>
        <option value="total_weekly">Average weekly earnings</option>
        <option value="women">% Women</option>
        <option value="men">% Men</option>
        <option value="white">% White</option>
        <option value="black">% African American</option>
        <option value="asian">% Asian</option>
        <option value="latino">% Hispanic or Latino</option>
        <option value="median_age">Median Age</option>
      </select>
      <p class="select-title category-title" class="clickable">Y-Axis</p>
      <select id="yaxis" onchange="changeAxis()">
        <option value="men_weekly" selected>Average weekly earnings for men</option>
        <option value="women_weekly">Average weekly earnings for women</option>
        <option value="total_weekly">Average Weekly Salary</option>
        <option value="women">% Women</option>
        <option value="men">% Men</option>
        <option value="white">% White</option>
        <option value="black">% African American</option>
        <option value="asian">% Asian</option>
        <option value="latino">% Hispanic or Latino</option>
        <option value="median_age">Median Age</option>
      </select>

      <hr>

      <p>Filter</p>
      <div class="legend">
        <div class="legend-category" data-supercategory="management">
          <p class="category-title">Management</p>
          <div class="tooltip-w3">
            <a onclick="clickCategory('Architecture and engineering occupations')">
              <div class="architecture square"></div>
            </a>
            <span class="tooltiptext">Architecture and engineering occupations</span>
          </div>
          <div class="tooltip-w3">
            <a onclick="clickCategory('Arts, design, entertainment, sports, and media occupations')">
              <div class="arts square"></div>
            </a>
            <span class="tooltiptext">Arts, design, entertainment, sports, and media occupations</span>
          </div>
          <div class="tooltip-w3">
            <a onclick="clickCategory('Business and financial operations occupations')">
              <div class="business square"></div>
            </a>
            <span class="tooltiptext">Business and financial operations occupations</span>
          </div>
          <div class="tooltip-w3">
            <a onclick="clickCategory('Community and social service occupations')">
              <div class="community square"></div>
            </a>
            <span class="tooltiptext">Community and social service occupations</span>
          </div>
          <div class="tooltip-w3">
            <a onclick="clickCategory('Education, training, and library occupations')">
              <div class="education square"></div>
            </a>
            <span class="tooltiptext">Education, training, and library occupations</span>
          </div>
          <div class="tooltip-w3">
            <a onclick="clickCategory('Healthcare practitioners and technical occupations')">
              <div class="healthcare square"></div>
            </a>
            <span class="tooltiptext">Healthcare practitioners and technical occupations</span>
          </div>
          <div class="tooltip-w3">
            <a onclick="clickCategory('Legal occupations')">
              <div class="legal square"></div>
            </a>
            <span class="tooltiptext">Legal occupations</span>
          </div>
          <div class="tooltip-w3">
            <a onclick="clickCategory('Life, physical, and social science occupations')">
              <div class="life square"></div>
            </a>
            <span class="tooltiptext">Life, physical, and social science occupations</span>
          </div>
          <div class="tooltip-w3">
            <a onclick="clickCategory('Management occupations')">
              <div class="management square"></div>
            </a>
            <span class="tooltiptext">Management occupations</span>
          </div>
        </div>
        <div class="legend-category">
          <p class="category-title">Production/transportation</p>
          <div class="tooltip-w3">
            <a onclick="clickCategory('Production occupations')">
              <div class="production square"></div>
            </a>
            <span class="tooltiptext">Production occupations</span>
          </div>
          <div class="tooltip-w3">
            <a onclick="clickCategory('Transportation and material moving occupations')">
              <div class="transportation square"></div>
            </a>
            <span class="tooltiptext">Transportation and material moving occupations</span>
          </div>
        </div>
        <div class="legend-category">
          <p class="category-title">Natural resources</p>
          <div class="tooltip-w3">
            <a onclick="clickCategory('Construction and extraction occupation')">
              <div class="construction square"></div>
            </a>
            <span class="tooltiptext">Construction and extraction occupation</span>
          </div>
          <div class="tooltip-w3">
            <a onclick="clickCategory('Farming, fishing, and forestry occupations')">
              <div class="farming square"></div>
            </a>
            <span class="tooltiptext">Farming, fishing, and forestry occupations</span>
          </div>
          <div class="tooltip-w3">
            <a onclick="clickCategory('Installation, maintenance, and repair occupations')">
              <div class="installation square"></div>
            </a>
            <span class="tooltiptext">Installation, maintenance, and repair occupations</span>
          </div>
        </div>
        <div class="legend-category">
          <p class="category-title">Sales/office</p>
          <div class="tooltip-w3">
            <a onclick="clickCategory('Office and administrative support occupations')">
              <div class="office square"></div>
            </a>
            <span class="tooltiptext">Office and administrative support occupations</span>
          </div>
          <div class="tooltip-w3">
            <a onclick="clickCategory('Sales and related occupations')">
              <div class="sales square"></div>
            </a>
            <span class="tooltiptext">Sales and related occupations</span>
          </div>
        </div>
        <div class="legend-category" data-supercategory="service">
          <p class="category-title">Service</p>
          <div class="tooltip-w3">
            <a onclick="clickCategory('Building and grounds cleaning and maintenance occupations')">
              <div class="building square"></div>
            </a>
            <span class="tooltiptext">Building and grounds cleaning and maintenance occupations</span>
          </div>
          <div class="tooltip-w3">
            <a onclick="clickCategory('Food preparation and serving related occupations')">
              <div class="food square"></div>
            </a>
            <span class="tooltiptext">Food preparation and serving related occupations</span>
          </div>
          <div class="tooltip-w3">
            <a onclick="clickCategory('Personal care and service occupations')">
              <div class="personal square"></div>
            </a>
            <span class="tooltiptext">Personal care and service occupations</span>
          </div>
          <div class="tooltip-w3">
            <a onclick="clickCategory('Protective service occupations')">
              <div class="protective square"></div>
            </a>
            <span class="tooltiptext">Protective service occupations</span>
          </div>
          <div class="tooltip-w3">
            <a onclick="clickCategory('Healthcare support occupations')">
              <div class="healthcare2 square"></div>
            </a>
            <span class="tooltiptext">Healthcare support occupations</span>
          </div>
        </div>
      </div>
      <hr>
      <a class="reset-zoom category-title clickable" onclick="resetZoom()">Reset Zoom</a>
      <a class="reset-zoom category-title clickable" onclick="showAllCategories()">Show All Categories</a>

    </div>
  </div>
  <div class="col-9 right-col">
    <canvas id="chart" width="600" height="400"></canvas>
  </div>
</div>

<script type="text/javascript" src="datasets.js"></script>

<script>

var ctx = document.getElementById('chart').getContext('2d');
var x_axis, y_axis;
var current_category_selections = {
  "Architecture and engineering occupations": true,
  "Arts, design, entertainment, sports, and media occupations": true,
  "Business and financial operations occupations": true,
  "Community and social service occupations": true,
  "Computer and mathematical occupations": true,
  "Education, training, and library occupations": true,
  "Healthcare practitioners and technical occupations": true,
  "Legal occupations": true,
  "Life, physical, and social science occupations": true,
  "Management occupations": true,
  "Construction and extraction occupation": true,
  "Farming, fishing, and forestry occupations": true,
  "Installation, maintenance, and repair occupations": true,
  "Production occupations": true,
  "Transportation and material moving occupations": true,
  "Office and administrative support occupations": true,
  "Sales and related occupations": true,
  "Building and grounds cleaning and maintenance occupations": true,
  "Food preparation and serving related occupations": true,
  "Personal care and service occupations": true,
  "Protective service occupations": true,
  "Healthcare support occupations": true,
};


var current_datasets = [];

var properLabels = {
  "num_employed": "Number Employed",
  "women": "Percentage of Women",
  "men": "Percentage of Men",
  "white": "Percentage of White Americans",
  "black": "Percentage of African Americans",
  "asian": "Percentage of Asian Americans",
  "latino": "Percentage of Hispanic/Latino descent",
  "total_weekly": "Average weekly earnings",
  "men_weekly": "Average weekly earnings for men",
  "women_weekly": "Average weekly earnings for women",
  "median_age": "Median age"
}

function showAllCategories() {
  // set all categories true
  Object.keys(current_category_selections).forEach(function(key) {
    current_category_selections[key] = true;
  });

  regenerateAndUpdate()
}

function clickCategory(category) {
  var allTrue = true;

  Object.keys(current_category_selections).forEach(function(key) {
    if (current_category_selections[key] == false) {
      allTrue = false;
    }
  });

  if (allTrue) {
    Object.keys(current_category_selections).forEach(function(key) {
      current_category_selections[key] = false;
    });
  }

  current_category_selections[category] = true;

  regenerateAndUpdate()
}

function regenerateAndUpdate() {
  generateRealDatasets();
  updateChart(scatterChart);
}


function getXaxisValue() {
  x_axis = document.getElementById("xaxis").value;
  // console.log('get x axis called')
}

function getYaxisValue() {
  y_axis = document.getElementById("yaxis").value;
  // console.log('get y axis called')
}

function changeAxis() {
  getXaxisValue();
  getYaxisValue();
  generateRealDatasets();
  updateChart(scatterChart);
}

function updateChart(chart) {
  $('#chart').remove();
  $('.right-col').append('<canvas id="chart" width="600" height="400"><canvas>');
  ctx = document.getElementById('chart').getContext('2d');
  scatterChart = new Chart(ctx, chartOptions());
}

function createDataset(x_axis,y_axis,dataset) {
  temp_dataset = [];
  dataset.forEach(function(currentValue, i) {
    temp_dataset.push({
      x: currentValue[x_axis],
      y: currentValue[y_axis],
      r: currentValue.num_employed/200
    })
  });
  return temp_dataset;
}

function numberWithCommas(x) {
    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}

function generateRealDatasets() {
  current_datasets = []
  // go through datasets.js and return a real dataset
  datasets.forEach(function(currentValue, i) {
    if (current_category_selections[currentValue.label]) {
      current_datasets.push({
        fill: currentValue.fill,
        backgroundColor: currentValue.backgroundColor,
        data: createDataset(x_axis,y_axis,currentValue.data),
      })
    }
  });
  // console.log('generate real datasets called')
}

function resetZoom() {
  scatterChart.resetZoom()
}

function chartOptions() {
  return {
        type: 'bubble',
        data: {
            datasets: current_datasets
        },
        options: {
            title: {
              display: true,
            },
            legend: {
              display: false
            },
            tooltips: {
              displayColors: false,
              titleFontFamily: "Lato",
              titleFontStyle: "Bold",
              titleFontSize: 18,
              bodyFontFamily: "Lato",
              bodyFontSize: 13,
              callbacks: {
                title: function(tooltipItem, data) {
                  // tooltipitem {0: []}
                  // Return value for title
                  var item = datasets[tooltipItem[0].datasetIndex].data[tooltipItem[0].index]
                  return item.job || '';
                },
                label: function(tooltipItem, data) {
                  var item = datasets[tooltipItem.datasetIndex].data[tooltipItem.index]
                  var label = [];
                  label.push("Number employed: " + numberWithCommas(item.num_employed*1000));

                  label.push("Women: " + item.women + "%");
                  label.push("Men: " + item.men + "%");
                  label.push("White: " + item.white + "%");
                  label.push("Black: " + item.black + "%");
                  label.push("Asian: " + item.asian + "%");
                  label.push("Hispanic/Latino: " + item.latino + "%");
                  label.push(""); // new line
                  label.push("Average Salary: $" + numberWithCommas(item.total_weekly) + "/week");
                  label.push("Average Male Salary: $" + numberWithCommas(item.men_weekly) + "/week");
                  label.push("Average Female Salary: $" + numberWithCommas(item.women_weekly) + "/week");
                  label.push(""); // new line
                  label.push("Median Age: " + item.median_age + " years");
                  return label;
                },
              }
            },
            scales: {
                xAxes: [{
                    type: 'linear',
                    scaleLabel: {
                      display: true,
                      labelString: properLabels[x_axis],
                      fontFamily: "Lato",
                      fontSize: 16,
                    },
                    ticks: {
                      fontFamily: "Lato",
                      fontStyle: "Bold"
                    }
                    // position: 'bottom'
                }],
                yAxes: [{
                    type: 'linear',
                    scaleLabel: {
                      display: true,
                      labelString: properLabels[y_axis],
                      fontFamily: "Lato",
                      fontSize: 16,
                    },
                    ticks: {
                      fontFamily: "Lato",
                      fontStyle: "Bold"
                    }
                    // position: 'bottom'
                }]
            },
            pan: {
          		enabled: true,
          		mode: 'xy',
          		speed: 20,
          		threshold: 10
          	},

            // Container for zoom options
            zoom: {
              // drag: true,
                speed: 0.01,
                enabled: true,
                mode: 'xy',
                  limits: {
      							max: 10,
      							min: 0.5
      						}
            }
        }
    }
}

getXaxisValue();
getYaxisValue();
generateRealDatasets();

var scatterChart;

scatterChart = new Chart(ctx, chartOptions());
</script>

	</body>
	
</html>